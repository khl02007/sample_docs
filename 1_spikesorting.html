
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spike Sorting &#8212; Spyglass Documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial: curation" href="2_curation.html" />
    <link rel="prev" title="Intro" href="0_intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Spyglass Documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Spyglass documentations
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Setup
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="setup.html">
   Setup
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="0_intro.html">
   Intro
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Spike Sorting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2_curation.html">
   Tutorial: curation
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/1_spikesorting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/khl02007/spyglass_docs"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/khl02007/spyglass_docs/issues/new?title=Issue%20on%20page%20%2F1_spikesorting.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/khl02007/spyglass_docs/master?urlpath=tree/docs/1_spikesorting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Spike Sorting
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spike-sorting-overview-with-associated-tables">
   Spike Sorting Overview - With associated tables
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-the-recording-from-the-nwb-file-br">
     Extracting the recording from the NWB file
     <br/>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spike-sorting-the-extracted-recording-br">
     Spike sorting the extracted recording
     <br/>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specifying-your-nwb-filename">
     Specifying your NWB filename
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#note-this-is-a-common-file-for-this-tutorial-table-entries-may-change-during-use-if-others-are-also-working-through">
     <strong>
      NOTE
     </strong>
     : This is a common file for this tutorial, table entries may change during use if others are also working through.
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-the-recording-from-the-nwb-file">
     Extracting the recording from the NWB file
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sortgroup">
       <code class="docutils literal notranslate">
        <span class="pre">
         SortGroup
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#intervallist">
       <code class="docutils literal notranslate">
        <span class="pre">
         IntervalList
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sortinterval">
       <code class="docutils literal notranslate">
        <span class="pre">
         SortInterval
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingfilterparameters">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingFilterParameters
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingartifactparameters">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingArtifactParameters
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#setting-a-key">
         Setting a key
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingrecordingselection">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingRecordingSelection
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingrecording">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingRecording
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#now-we-can-see-our-recording-in-the-table-e-x-c-i-t-i-n-g">
         Now we can see our recording in the table.
         <em>
          E x c i t i n g !
         </em>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingworkspace">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingWorkspace
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spike-sorting-the-extracted-recording">
     Spike sorting the extracted recording
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesorter">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSorter
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesorterparameters">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSorterParameters
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingselection">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingSelection
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gearing-up-to-spike-sort">
         Gearing up to Spike Sort!
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesorting">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSorting
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#check-to-make-sure-the-table-populated">
         Check to make sure the table populated
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#revisiting-spikesortingworkspace">
       Revisiting
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingWorkspace
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#see-2-curation-for-the-next-tutorial">
       See 2_curation for the next tutorial
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Spike Sorting</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Spike Sorting
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spike-sorting-overview-with-associated-tables">
   Spike Sorting Overview - With associated tables
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-the-recording-from-the-nwb-file-br">
     Extracting the recording from the NWB file
     <br/>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spike-sorting-the-extracted-recording-br">
     Spike sorting the extracted recording
     <br/>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specifying-your-nwb-filename">
     Specifying your NWB filename
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#note-this-is-a-common-file-for-this-tutorial-table-entries-may-change-during-use-if-others-are-also-working-through">
     <strong>
      NOTE
     </strong>
     : This is a common file for this tutorial, table entries may change during use if others are also working through.
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-the-recording-from-the-nwb-file">
     Extracting the recording from the NWB file
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sortgroup">
       <code class="docutils literal notranslate">
        <span class="pre">
         SortGroup
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#intervallist">
       <code class="docutils literal notranslate">
        <span class="pre">
         IntervalList
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sortinterval">
       <code class="docutils literal notranslate">
        <span class="pre">
         SortInterval
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingfilterparameters">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingFilterParameters
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingartifactparameters">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingArtifactParameters
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#setting-a-key">
         Setting a key
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingrecordingselection">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingRecordingSelection
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingrecording">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingRecording
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#now-we-can-see-our-recording-in-the-table-e-x-c-i-t-i-n-g">
         Now we can see our recording in the table.
         <em>
          E x c i t i n g !
         </em>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingworkspace">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingWorkspace
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spike-sorting-the-extracted-recording">
     Spike sorting the extracted recording
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesorter">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSorter
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesorterparameters">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSorterParameters
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesortingselection">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingSelection
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gearing-up-to-spike-sort">
         Gearing up to Spike Sort!
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spikesorting">
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSorting
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#check-to-make-sure-the-table-populated">
         Check to make sure the table populated
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#revisiting-spikesortingworkspace">
       Revisiting
       <code class="docutils literal notranslate">
        <span class="pre">
         SpikeSortingWorkspace
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#see-2-curation-for-the-next-tutorial">
       See 2_curation for the next tutorial
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="spike-sorting">
<h1>Spike Sorting<a class="headerlink" href="#spike-sorting" title="Permalink to this headline">¶</a></h1>
<p><strong>Note: make a copy of this notebook and run the copy to avoid git conflicts in the future</strong></p>
<p>This is the second in a multi-part tutorial on the NWB-Datajoint pipeline used in Loren Frank’s lab, UCSF. It demonstrates how to run spike sorting and curate units within the pipeline.</p>
<p>If you have not done <a class="reference internal" href="0_intro.html"><span class="doc std std-doc">tutorial 0</span></a> yet, make sure to do so before proceeding. It is also recommended that you complete the <a class="reference external" href="https://tutorials.datajoint.io/">datajoint tutorials</a> before starting this.</p>
<p><strong>Note 2: Make sure you are running this within the nwb_datajoint Conda environment)</strong></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="spike-sorting-overview-with-associated-tables">
<h1>Spike Sorting Overview - With associated tables<a class="headerlink" href="#spike-sorting-overview-with-associated-tables" title="Permalink to this headline">¶</a></h1>
<div class="section" id="extracting-the-recording-from-the-nwb-file-br">
<h2><a class="reference external" href="#section1">Extracting the recording from the NWB file</a><br><a class="headerlink" href="#extracting-the-recording-from-the-nwb-file-br" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Specifying your <a class="reference external" href="#Specifying-your-NWB-filename">NWB</a> file.<br></p></li>
<li><p>Specifying which electrodes involved in the recording to sort data from. - <a class="reference external" href="#SortGroup"><code class="docutils literal notranslate"><span class="pre">SortGroup</span></code></a><br></p></li>
<li><p>Specifying the time segment of the recording we want to sort. - <a class="reference external" href="#IntervalList"><code class="docutils literal notranslate"><span class="pre">IntervalList</span></code></a>, <a class="reference external" href="#SortInterval"><code class="docutils literal notranslate"><span class="pre">SortInterval</span></code></a><br></p></li>
<li><p>Specifying the parameters to use for filtering the recording. - <a class="reference external" href="#SpikeSortingFilterParameters"><code class="docutils literal notranslate"><span class="pre">SpikeSortingFilterParameters</span></code></a><br></p></li>
<li><p>Specifying the parameters to apply for artifact detection/removal. -<a class="reference external" href="#SpikeSortingArtifactParameters"><code class="docutils literal notranslate"><span class="pre">SpikeSortingArtifactParameters</span></code></a><br></p></li>
<li><p>Combining these parameters. - <a class="reference external" href="#SpikeSortingRecordingSelection"><code class="docutils literal notranslate"><span class="pre">SpikeSortingRecordingSelection</span></code></a><br></p></li>
<li><p>Extracting the recording. - <a class="reference external" href="#SpikeSortingRecording"><code class="docutils literal notranslate"><span class="pre">SpikeSortingRecording</span></code></a><br></p></li>
<li><p>Add extracted recording to kachery server. - <a class="reference external" href="#SpikeSortingWorkspace"><code class="docutils literal notranslate"><span class="pre">SpikeSortingWorkspace</span></code></a></p></li>
</ol>
</div>
<div class="section" id="spike-sorting-the-extracted-recording-br">
<h2><a class="reference external" href="#section2">Spike sorting the extracted recording</a><br><a class="headerlink" href="#spike-sorting-the-extracted-recording-br" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Choose which spike sorting algorithm to use. - <a class="reference external" href="#SpikeSorter"><code class="docutils literal notranslate"><span class="pre">SpikeSorter</span></code></a><br></p></li>
<li><p>Specify the parameters for that spike sorter to use. - <a class="reference external" href="#SpikeSorterParameters"><code class="docutils literal notranslate"><span class="pre">SpikeSorterParameters</span></code></a><br></p></li>
<li><p>Combine these parameters. - <a class="reference external" href="#SpikeSortingSelection"><code class="docutils literal notranslate"><span class="pre">SpikeSortingSelection</span></code></a><br></p></li>
<li><p>Spike sort the extracted recording according to chose parameter set. - <a class="reference external" href="#SpikeSorting"><code class="docutils literal notranslate"><span class="pre">SpikeSorting</span></code></a><br></p></li>
<li><p>Visualizing the sort using figurl. - <a class="reference external" href="#Revisiting-SpikeSortingWorkspace"><code class="docutils literal notranslate"><span class="pre">Visualize</span></code></a><br></p></li>
</ol>
<p><a href='#section1'></a>
<a href='#section2'></a></p>
<p>Let’s start by importing tables from nwb_datajoint along with some other useful packages</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
<span class="kn">import</span> <span class="nn">nwb_datajoint</span> <span class="k">as</span> <span class="nn">nd</span>
<span class="c1"># ignore datajoint+jupyter async warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">ResourceWarning</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nwb_datajoint.common</span> <span class="kn">import</span> <span class="p">(</span><span class="n">SortGroup</span><span class="p">,</span> <span class="n">SpikeSortingFilterParameters</span><span class="p">,</span>
                                  <span class="n">SpikeSortingArtifactDetectionParameters</span><span class="p">,</span>
                                  <span class="n">SpikeSortingRecordingSelection</span><span class="p">,</span> <span class="n">SpikeSortingRecording</span><span class="p">,</span> 
                                  <span class="n">SpikeSortingWorkspace</span><span class="p">,</span> <span class="n">SortingID</span><span class="p">,</span>
                                  <span class="n">SpikeSorter</span><span class="p">,</span> <span class="n">SpikeSorterParameters</span><span class="p">,</span>
                                  <span class="n">SpikeSortingSelection</span><span class="p">,</span> <span class="n">SpikeSorting</span><span class="p">,</span> 
                                  <span class="n">SpikeSortingMetricParameters</span><span class="p">,</span>
                                  <span class="n">AutomaticCurationParameters</span><span class="p">,</span> <span class="n">AutomaticCurationSelection</span><span class="p">,</span>
                                  <span class="n">AutomaticCuration</span><span class="p">,</span> <span class="n">Nwbfile</span><span class="p">,</span>
                                  <span class="n">CuratedSpikeSortingSelection</span><span class="p">,</span> <span class="n">CuratedSpikeSorting</span><span class="p">,</span>
                                  <span class="n">IntervalList</span><span class="p">,</span> <span class="n">SortInterval</span><span class="p">,</span>
                                  <span class="n">LabMember</span><span class="p">,</span> <span class="n">LabTeam</span><span class="p">,</span> <span class="n">Raw</span><span class="p">,</span> <span class="n">Session</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s make sure that you’re a part of the LorenLab <code class="docutils literal notranslate"><span class="pre">LabTeam</span></code>, so you’ll have the right permissions for this tutorial.<br>Replace <code class="docutils literal notranslate"><span class="pre">your_name</span></code>, <code class="docutils literal notranslate"><span class="pre">your_email</span></code>, and <code class="docutils literal notranslate"><span class="pre">datajoint_username</span></code>, with your information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">your_name</span> <span class="o">=</span> <span class="s1">&#39;FirstName LastName&#39;</span>
<span class="n">your_email</span> <span class="o">=</span> <span class="s1">&#39;gmail@gmail.com&#39;</span>
<span class="n">datajoint_username</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lorenlab_team_members</span> <span class="o">=</span> <span class="p">(</span><span class="n">LabTeam</span><span class="p">()</span><span class="o">.</span><span class="n">LabTeamMember</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;team_name&#39;</span> <span class="p">:</span> <span class="s1">&#39;LorenLab&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;lab_member_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">LabMember</span><span class="o">.</span><span class="n">insert_from_name</span><span class="p">(</span><span class="n">your_name</span><span class="p">)</span>
<span class="n">LabMember</span><span class="o">.</span><span class="n">LabMemberInfo</span><span class="o">.</span><span class="n">insert1</span><span class="p">([</span><span class="n">your_name</span><span class="p">,</span> <span class="n">your_email</span><span class="p">,</span> <span class="n">datajoint_username</span><span class="p">],</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">LabTeam</span><span class="o">.</span><span class="n">LabTeamMember</span><span class="o">.</span><span class="n">insert1</span><span class="p">({</span><span class="s1">&#39;team_name&#39;</span> <span class="p">:</span> <span class="s1">&#39;LorenLab&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;lab_member_name&#39;</span> <span class="p">:</span> <span class="n">your_name</span><span class="p">},</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now try and use the <code class="docutils literal notranslate"><span class="pre">fetch</span></code> command and the example above to complete the code below and query the <code class="docutils literal notranslate"><span class="pre">LabTeam</span></code> table to double-check that you are a part of the <code class="docutils literal notranslate"><span class="pre">LorenLab</span></code> team.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">your_name</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LabTeam</span><span class="o">.</span><span class="n">_____</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">{</span><span class="n">___</span><span class="p">:</span><span class="n">____</span><span class="p">})</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">______</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You made it in!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="specifying-your-nwb-filename">
<h2>Specifying your NWB filename<a class="headerlink" href="#specifying-your-nwb-filename" title="Permalink to this headline">¶</a></h2>
<p>NWB filenames take the form of an animal name plus the date of the recording.<br>For this tutorial, we will use the nwb file <code class="docutils literal notranslate"><span class="pre">'montague20200802_tutorial_.nwb'</span></code>. The animal name is <code class="docutils literal notranslate"><span class="pre">montague</span></code> and the date of the recording is <code class="docutils literal notranslate"><span class="pre">20200802</span></code>, the <code class="docutils literal notranslate"><span class="pre">tutorial</span></code> is unique to this setting :-).<br>We’ll first re-insert the NWB file that you deleted at the end of <code class="docutils literal notranslate"><span class="pre">0_intro</span></code>. This file may already be in the table, in which case there will be a warning, that’s ok!<br><strong>Note</strong>: If you’re not on the Frank Lab server, this file will be accessible as <code class="docutils literal notranslate"><span class="pre">montague20200802.nwb</span></code> on DANDI through this URL: <strong>insert-url</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nd</span><span class="o">.</span><span class="n">insert_sessions</span><span class="p">(</span><span class="s1">&#39;montague20200802_tutorial.nwb&#39;</span><span class="p">)</span>
<span class="n">nwb_file_name</span> <span class="o">=</span> <span class="s1">&#39;montague20200802_tutorial_.nwb&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="note-this-is-a-common-file-for-this-tutorial-table-entries-may-change-during-use-if-others-are-also-working-through">
<h2><strong>NOTE</strong>: This is a common file for this tutorial, table entries may change during use if others are also working through.<a class="headerlink" href="#note-this-is-a-common-file-for-this-tutorial-table-entries-may-change-during-use-if-others-are-also-working-through" title="Permalink to this headline">¶</a></h2>
<p><a id='section1'></a></p>
</div>
<div class="section" id="extracting-the-recording-from-the-nwb-file">
<h2>Extracting the recording from the NWB file<a class="headerlink" href="#extracting-the-recording-from-the-nwb-file" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sortgroup">
<h3><code class="docutils literal notranslate"><span class="pre">SortGroup</span></code><a class="headerlink" href="#sortgroup" title="Permalink to this headline">¶</a></h3>
<p>For each NWB file there will be multiple electrodes available to sort spikes from.<br>We commonly sort over multiple electrodes at a time, also referred to as a <code class="docutils literal notranslate"><span class="pre">SortGroup</span></code>.<br>This is accomplished by grouping electrodes according to what tetrode or shank of a probe they were on.<br><strong>NOTE</strong>: answer ‘yes’ when prompted</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># answer &#39;yes&#39; when prompted</span>
<span class="n">SortGroup</span><span class="p">()</span><span class="o">.</span><span class="n">set_group_by_shank</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Each electrode will have an <code class="docutils literal notranslate"><span class="pre">electrode_id</span></code> and be associated with an <code class="docutils literal notranslate"><span class="pre">electrode_group_name</span></code>, which will correspond with a <code class="docutils literal notranslate"><span class="pre">sort_group_id</span></code>. In this case, the data was recorded from a 32 tetrode (128 channel) drive, and thus results in 128 unique <code class="docutils literal notranslate"><span class="pre">electrode_id</span></code>, 32 unique <code class="docutils literal notranslate"><span class="pre">electrode_group_name</span></code>, and 32 unique <code class="docutils literal notranslate"><span class="pre">sort_group_id</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SortGroup</span><span class="o">.</span><span class="n">SortGroupElectrode</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;nwb_file_name&#39;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="intervallist">
<h3><code class="docutils literal notranslate"><span class="pre">IntervalList</span></code><a class="headerlink" href="#intervallist" title="Permalink to this headline">¶</a></h3>
<p>Next, we make a decision about the time interval for our spike sorting. Let’s re-examine <code class="docutils literal notranslate"><span class="pre">IntervalList</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IntervalList</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;nwb_file_name&#39;</span> <span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>For our example, let’s choose to start with the first run interval (<code class="docutils literal notranslate"><span class="pre">02_r1</span></code>) as our sort interval. We first fetch <code class="docutils literal notranslate"><span class="pre">valid_times</span></code> for this interval.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interval_list_name</span> <span class="o">=</span> <span class="s1">&#39;02_r1&#39;</span>
<span class="n">interval_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">IntervalList</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;nwb_file_name&#39;</span> <span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">,</span>
                            <span class="s1">&#39;interval_list_name&#39;</span> <span class="p">:</span> <span class="n">interval_list_name</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;valid_times&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;IntervalList begins as a </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">interval_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">interval_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1"> min long epoch&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sortinterval">
<h3><code class="docutils literal notranslate"><span class="pre">SortInterval</span></code><a class="headerlink" href="#sortinterval" title="Permalink to this headline">¶</a></h3>
<p>For brevity’s sake, we’ll select only the first 180 seconds of that 90 minute epoch as our sort interval. To do so, we define our new sort interval as the start time of <code class="docutils literal notranslate"><span class="pre">interval_list</span></code> from the previous cell, plus 180 seconds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sort_interval</span> <span class="o">=</span> <span class="n">interval_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">sort_interval_name</span> <span class="o">=</span> <span class="n">interval_list_name</span> <span class="o">+</span> <span class="s1">&#39;_first180&#39;</span>
<span class="n">sort_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">interval_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
<span class="n">sort_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">180</span>
</pre></div>
</div>
</div>
</div>
<p>We can now add this <code class="docutils literal notranslate"><span class="pre">sort_interval</span></code> with the specified <code class="docutils literal notranslate"><span class="pre">sort_interval_name</span></code> <code class="docutils literal notranslate"><span class="pre">'02_r1_first180'</span></code> to the <code class="docutils literal notranslate"><span class="pre">SortInterval</span></code> table. The <code class="docutils literal notranslate"><span class="pre">SortInterval.insert()</span></code> function requires the arguments input as a dictionary with keys <code class="docutils literal notranslate"><span class="pre">nwb_file_name</span></code>, <code class="docutils literal notranslate"><span class="pre">sort_interval_name</span></code>, and <code class="docutils literal notranslate"><span class="pre">sort_interval</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SortInterval</span><span class="o">.</span><span class="n">insert1</span><span class="p">({</span><span class="s1">&#39;nwb_file_name&#39;</span> <span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">,</span>
                     <span class="s1">&#39;sort_interval_name&#39;</span> <span class="p">:</span> <span class="n">sort_interval_name</span><span class="p">,</span>
                     <span class="s1">&#39;sort_interval&#39;</span> <span class="p">:</span> <span class="n">sort_interval</span><span class="p">},</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we’ve inserted the entry into <code class="docutils literal notranslate"><span class="pre">SortInterval</span></code> you can see that entry by querying <code class="docutils literal notranslate"><span class="pre">SortInterval</span></code> using the <code class="docutils literal notranslate"><span class="pre">nwb_file_name</span></code> and <code class="docutils literal notranslate"><span class="pre">sort_interval_name</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SortInterval</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;nwb_file_name&#39;</span> <span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">,</span> <span class="s1">&#39;sort_interval_name&#39;</span><span class="p">:</span> <span class="n">sort_interval_name</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now using the <code class="docutils literal notranslate"><span class="pre">.fetch()</span></code> command, you can retrieve your user-defined sort interval from the <code class="docutils literal notranslate"><span class="pre">SortInterval</span></code> table.<br>A quick double-check will show that it is indeed a 180 second segment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fetched_sort_interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">SortInterval</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;nwb_file_name&#39;</span> <span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">,</span>
                                      <span class="s1">&#39;sort_interval_name&#39;</span><span class="p">:</span> <span class="n">sort_interval_name</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;sort_interval&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The sort interval goes from </span><span class="si">{</span><span class="n">fetched_sort_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">fetched_sort_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="se">\</span>
<span class="s1">which is </span><span class="si">{</span><span class="p">(</span><span class="n">fetched_sort_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fetched_sort_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1"> seconds. COOL!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesortingfilterparameters">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSortingFilterParameters</span></code><a class="headerlink" href="#spikesortingfilterparameters" title="Permalink to this headline">¶</a></h3>
<p>Let’s first take a look at the <code class="docutils literal notranslate"><span class="pre">SpikeSortingFilterParameters</span></code> table, which contains the parameters used to filter the recorded data in the spike band prior to spike sorting it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingFilterParameters</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s set the filtering parameters. Here we insert the default parameters, and then fetch the default parameter dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingFilterParameters</span><span class="p">()</span><span class="o">.</span><span class="n">insert_default</span><span class="p">()</span>
<span class="n">filter_param_dict</span> <span class="o">=</span> <span class="p">(</span><span class="n">SpikeSortingFilterParameters</span><span class="p">()</span> <span class="o">&amp;</span>
                     <span class="p">{</span><span class="s1">&#39;filter_parameter_set_name&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;filter_parameter_dict&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filter_param_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets first adjust the <code class="docutils literal notranslate"><span class="pre">frequency_min</span></code> parameter to 600, which is the preference for hippocampal data. Now we can insert that into <code class="docutils literal notranslate"><span class="pre">SpikeSortingFilterParameters</span></code> as a new set of filtering parameters for hippocampal data, named <code class="docutils literal notranslate"><span class="pre">'franklab_default_hippocampus'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filter_param_dict</span><span class="p">[</span><span class="s1">&#39;frequency_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">SpikeSortingFilterParameters</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">({</span><span class="s1">&#39;filter_parameter_set_name&#39;</span><span class="p">:</span> <span class="s1">&#39;franklab_default_hippocampus&#39;</span><span class="p">,</span> 
                                       <span class="s1">&#39;filter_parameter_dict&#39;</span> <span class="p">:</span> <span class="n">filter_param_dict</span><span class="p">},</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesortingartifactparameters">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSortingArtifactParameters</span></code><a class="headerlink" href="#spikesortingartifactparameters" title="Permalink to this headline">¶</a></h3>
<p>Similarly, we set up the <code class="docutils literal notranslate"><span class="pre">SpikeSortingArtifactParameters</span></code>, which can allow us to remove artifacts from the data.<br>Specifically, we want to target artifact signal that is within the frequency band of our filter (600Hz-6KHz), and thus will not get removed by filtering.<br>For the moment we just set up a <code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code> parameter set, which will do nothing when used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingArtifactDetectionParameters</span><span class="p">()</span><span class="o">.</span><span class="n">insert_default</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-a-key">
<h4>Setting a key<a class="headerlink" href="#setting-a-key" title="Permalink to this headline">¶</a></h4>
<p>Now we set up the parameters of the recording we are interested in, and make a dictionary to hold all these values, which will make querying and inserting into tables all the easier moving forward.<br>We’ll assign this to <code class="docutils literal notranslate"><span class="pre">ssr_key</span></code> as these values are relvant to the recording we’ll use to spike sort, also referred to as the spike sorting recording <strong>(ssr)</strong> :-)<br>The <code class="docutils literal notranslate"><span class="pre">sort_group_id</span></code> refers back to the <code class="docutils literal notranslate"><span class="pre">SortGroup</span></code> table we populated at the beginning of the tutorial. We’ll use <code class="docutils literal notranslate"><span class="pre">sort_group_id</span></code> 10 here. <br>Our <code class="docutils literal notranslate"><span class="pre">sort_interval_name</span></code> is the same as above: <code class="docutils literal notranslate"><span class="pre">'02_r1_first600'</span></code>.<br>Our <code class="docutils literal notranslate"><span class="pre">filter_param_name</span></code> and <code class="docutils literal notranslate"><span class="pre">artifact_param_name</span></code> are the same ones we just inserted into <code class="docutils literal notranslate"><span class="pre">SpikeSortingFilterParameters</span></code> and <code class="docutils literal notranslate"><span class="pre">SpikeSortingArtifactDetectionParameters</span></code>, respectively.<br>The <code class="docutils literal notranslate"><span class="pre">interval_list</span></code> was also set above as <code class="docutils literal notranslate"><span class="pre">'02_r1'</span></code>. Unlike <code class="docutils literal notranslate"><span class="pre">sort_interval_name</span></code>, which reflects our subsection of the recording, we keep <code class="docutils literal notranslate"><span class="pre">interval_list</span></code> unchanged from the original epoch name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;nwb_file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;sort_group_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;sort_interval_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;02_r1_first180&#39;</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;filter_parameter_set_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;franklab_default_hippocampus&#39;</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;artifact_parameter_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;interval_list_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;02_r1&#39;</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;team_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LorenLab&#39;</span>

<span class="n">ssr_key</span> <span class="o">=</span> <span class="n">key</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesortingrecordingselection">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSortingRecordingSelection</span></code><a class="headerlink" href="#spikesortingrecordingselection" title="Permalink to this headline">¶</a></h3>
<p>We now insert all of these parameters into the <code class="docutils literal notranslate"><span class="pre">SpikeSortingRecordingSelection</span></code> table, which we will use to specify what time/tetrode/etc of the recording we want to extract.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingRecordingSelection</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">ssr_key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">SpikeSortingRecordingSelection</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ssr_key</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesortingrecording">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSortingRecording</span></code><a class="headerlink" href="#spikesortingrecording" title="Permalink to this headline">¶</a></h3>
<p>And now we’re ready to extract the recording! We use the <code class="docutils literal notranslate"><span class="pre">.proj()</span></code> command to pass along all of the primary keys from the <code class="docutils literal notranslate"><span class="pre">SpikeSortingRecordingSelection</span></code> table to the <code class="docutils literal notranslate"><span class="pre">SpikeSortingRecording</span></code> table, so it knows exactly what to extract.<br><strong>Note</strong>: This step might take a bit with longer duration sort intervals</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingRecording</span><span class="o">.</span><span class="n">populate</span><span class="p">([(</span><span class="n">SpikeSortingRecordingSelection</span> <span class="o">&amp;</span> <span class="n">ssr_key</span><span class="p">)</span><span class="o">.</span><span class="n">proj</span><span class="p">()])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="now-we-can-see-our-recording-in-the-table-e-x-c-i-t-i-n-g">
<h4>Now we can see our recording in the table. <em>E x c i t i n g !</em><a class="headerlink" href="#now-we-can-see-our-recording-in-the-table-e-x-c-i-t-i-n-g" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingRecording</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ssr_key</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesortingworkspace">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSortingWorkspace</span></code><a class="headerlink" href="#spikesortingworkspace" title="Permalink to this headline">¶</a></h3>
<p>Now we need to populate the <code class="docutils literal notranslate"><span class="pre">SpikeSortingWorkspace</span></code> table to make this recording available via kachery (our server backend).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingWorkspace</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingWorkspace</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ssr_key</span>
</pre></div>
</div>
</div>
</div>
<p><a id='section2'></a></p>
</div>
</div>
<div class="section" id="spike-sorting-the-extracted-recording">
<h2>Spike sorting the extracted recording<a class="headerlink" href="#spike-sorting-the-extracted-recording" title="Permalink to this headline">¶</a></h2>
<div class="section" id="spikesorter">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSorter</span></code><a class="headerlink" href="#spikesorter" title="Permalink to this headline">¶</a></h3>
<p>For our example, we will be using <code class="docutils literal notranslate"><span class="pre">mountainsort4</span></code>. There are already some default parameters in the <code class="docutils literal notranslate"><span class="pre">SpikeSorterParameters</span></code> table we’ll <code class="docutils literal notranslate"><span class="pre">fetch</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSorter</span><span class="p">()</span><span class="o">.</span><span class="n">insert_from_spikeinterface</span><span class="p">()</span>
<span class="n">SpikeSorterParameters</span><span class="p">()</span><span class="o">.</span><span class="n">insert_from_spikeinterface</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s look at the default params</span>
<span class="n">sorter_name</span><span class="o">=</span><span class="s1">&#39;mountainsort4&#39;</span>
<span class="n">ms4_default_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">SpikeSorterParameters</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;sorter_name&#39;</span> <span class="p">:</span> <span class="n">sorter_name</span><span class="p">,</span>
                                               <span class="s1">&#39;spikesorter_parameter_set_name&#39;</span> <span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms4_default_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can change these default parameters to line up more closely with our preferences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_dict</span> <span class="o">=</span> <span class="n">ms4_default_params</span><span class="p">[</span><span class="s1">&#39;parameter_dict&#39;</span><span class="p">]</span>
<span class="c1"># Detect downward going spikes (1 is for upward, 0 is for both up and down)</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;detect_sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> 
<span class="c1"># We will sort electrodes together that are within 100 microns of each other</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;adjacency_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;curation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># Turn filter off since we will filter it prior to starting sort</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;freq_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;freq_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Turn whiten off since we will whiten it prior to starting sort</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;whiten&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># set num_workers to be the same number as the number of electrodes</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;num_workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># set clip size as number of samples for 1.33 millisecond based on the sampling rate</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;clip_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="mf">1.33e-3</span> <span class="o">*</span> <span class="p">(</span><span class="n">Raw</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;nwb_file_name&#39;</span> <span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">))</span>
<span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;noise_overlap_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">param_dict</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesorterparameters">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSorterParameters</span></code><a class="headerlink" href="#spikesorterparameters" title="Permalink to this headline">¶</a></h3>
<p>Let’s go ahead and insert a new <code class="docutils literal notranslate"><span class="pre">spikesorter_parameter_set_name</span></code> and <code class="docutils literal notranslate"><span class="pre">parameter_dict</span></code> into the <code class="docutils literal notranslate"><span class="pre">SpikeSorterParameters</span></code> table named <code class="docutils literal notranslate"><span class="pre">franklab_hippocampus_tutorial</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameter_set_name</span> <span class="o">=</span> <span class="s1">&#39;franklab_hippocampus_tutorial&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Now we insert our parameters for use by the spike sorter into <code class="docutils literal notranslate"><span class="pre">SpikeSorterParameters</span></code> and double-check that it made it in to the table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSorterParameters</span><span class="o">.</span><span class="n">insert1</span><span class="p">({</span><span class="s1">&#39;sorter_name&#39;</span><span class="p">:</span> <span class="n">sorter_name</span><span class="p">,</span>
                               <span class="s1">&#39;spikesorter_parameter_set_name&#39;</span><span class="p">:</span> <span class="n">parameter_set_name</span><span class="p">,</span>
                               <span class="s1">&#39;parameter_dict&#39;</span><span class="p">:</span> <span class="n">param_dict</span><span class="p">},</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Check that insert was successful</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">SpikeSorterParameters</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;sorter_name&#39;</span><span class="p">:</span> <span class="n">sorter_name</span><span class="p">,</span> <span class="s1">&#39;spikesorter_parameter_set_name&#39;</span><span class="p">:</span> <span class="n">parameter_set_name</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
<span class="n">p</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesortingselection">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSortingSelection</span></code><a class="headerlink" href="#spikesortingselection" title="Permalink to this headline">¶</a></h3>
<div class="section" id="gearing-up-to-spike-sort">
<h4>Gearing up to Spike Sort!<a class="headerlink" href="#gearing-up-to-spike-sort" title="Permalink to this headline">¶</a></h4>
<p>We now collect all the decisions we made up to here and put it into the <code class="docutils literal notranslate"><span class="pre">SpikeSortingSelection</span></code> table, which is specific to this recording and eventual sorting segment.<br>We’ll add in a few parameters to our key and call it <code class="docutils literal notranslate"><span class="pre">ss_key</span></code>.<br>(<strong>note</strong>: the spike <em>sorter</em> parameters defined above are for the sorter, <code class="docutils literal notranslate"><span class="pre">mountainsort4</span></code> in this case.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">SpikeSortingWorkspace</span> <span class="o">&amp;</span> <span class="n">ssr_key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;KEY&quot;</span><span class="p">)</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;sorter_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorter_name</span>
<span class="n">key</span><span class="p">[</span><span class="s1">&#39;spikesorter_parameter_set_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter_set_name</span>
<span class="n">ss_key</span> <span class="o">=</span> <span class="n">key</span>
<span class="n">SpikeSortingSelection</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">ss_key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">(</span><span class="n">SpikeSortingSelection</span> <span class="o">&amp;</span> <span class="n">ss_key</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="spikesorting">
<h3><code class="docutils literal notranslate"><span class="pre">SpikeSorting</span></code><a class="headerlink" href="#spikesorting" title="Permalink to this headline">¶</a></h3>
<p>Now we can run spike sorting. It’s nothing more than populating a table (<code class="docutils literal notranslate"><span class="pre">SpikeSorting</span></code>) based on the entries of <code class="docutils literal notranslate"><span class="pre">SpikeSortingSelection</span></code>.<br><strong>Note</strong>: This will take a little bit with longer data sets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSorting</span><span class="o">.</span><span class="n">populate</span><span class="p">([(</span><span class="n">SpikeSortingSelection</span> <span class="o">&amp;</span> <span class="n">ss_key</span><span class="p">)</span><span class="o">.</span><span class="n">proj</span><span class="p">()])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="check-to-make-sure-the-table-populated">
<h4>Check to make sure the table populated<a class="headerlink" href="#check-to-make-sure-the-table-populated" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSorting</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ss_key</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="revisiting-spikesortingworkspace">
<h3>Revisiting <code class="docutils literal notranslate"><span class="pre">SpikeSortingWorkspace</span></code><a class="headerlink" href="#revisiting-spikesortingworkspace" title="Permalink to this headline">¶</a></h3>
<p>To peform manual curation, we use the <code class="docutils literal notranslate"><span class="pre">figurl</span></code> interface.<br><code class="docutils literal notranslate"><span class="pre">figurl</span></code> will load more quickly if we run <code class="docutils literal notranslate"><span class="pre">SpikeSortingWorkspace().precalculate()</span></code> beforehand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SpikeSortingWorkspace</span><span class="p">()</span><span class="o">.</span><span class="n">precalculate</span><span class="p">(</span><span class="n">ssr_key</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here we’ll use the sortingview backend to access the figurl <em>url</em>. We do this by loading the workspace that we set up while populating <code class="docutils literal notranslate"><span class="pre">SpikeSortingWorkspace</span></code>.<br>This workspace, in tandem with the ids of the spike sorting and recording segment we extracted during this tutorial, will allow us to retrieve the url. We’ll also use this opportunity to enable permissions for everyone to curate this sorting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sortingview</span> <span class="k">as</span> <span class="nn">sv</span>
<span class="n">workspace</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">load_workspace</span><span class="p">((</span><span class="n">SpikeSortingWorkspace</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ssr_key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;workspace_uri&#39;</span><span class="p">))</span>
<span class="n">sorting_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">SortingID</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ssr_key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;sorting_id&#39;</span><span class="p">)</span>
<span class="n">recording_id</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="n">recording_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="n">experimental_spikesortingview</span><span class="p">(</span><span class="n">recording_id</span><span class="o">=</span><span class="n">recording_id</span><span class="p">,</span> <span class="n">sorting_id</span><span class="o">=</span><span class="n">sorting_id</span><span class="p">,</span>
                                                  <span class="n">label</span><span class="o">=</span><span class="n">workspace</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">include_curation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">member_emails</span> <span class="o">=</span> <span class="n">LabMember</span><span class="p">()</span><span class="o">.</span><span class="n">LabMemberInfo</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;lab_member_name&#39;</span><span class="p">,</span><span class="s1">&#39;google_user_name&#39;</span><span class="p">)</span>
<span class="n">member_dict</span> <span class="o">=</span> <span class="p">[</span><span class="n">email</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">member_emails</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">member_emails</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lorenlab_team_members</span><span class="p">]</span>
<span class="n">workspace</span><span class="o">.</span><span class="n">set_sorting_curation_authorized_users</span><span class="p">(</span><span class="n">sorting_id</span><span class="o">=</span><span class="n">sorting_id</span><span class="p">,</span> <span class="n">user_ids</span><span class="o">=</span><span class="n">member_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="see-2-curation-for-the-next-tutorial">
<h3>See 2_curation for the next tutorial<a class="headerlink" href="#see-2-curation-for-the-next-tutorial" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-nwb_datajoint-py"
        },
        kernelOptions: {
            kernelName: "conda-env-nwb_datajoint-py",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-nwb_datajoint-py'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="0_intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Intro</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="2_curation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial: curation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Loren Frank Lab<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>